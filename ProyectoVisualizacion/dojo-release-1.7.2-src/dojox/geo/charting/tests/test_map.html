	<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Chart: Map&Chart</title>
		<style type="text/css">
			@import "../../../../dojo/resources/dojo.css";
			@import "../../../../dijit/tests/css/dijitTests.css";
			@import "../../../../dijit/themes/tundra/tundra.css";
			@import "../resources/Map.css";
			.mapContainer {
				display: none;
				width: 810px;
				height: 400px;
				border: solid 1px;
			}
			
			.mapVerticalContainer {
				display: none;
				width: 405px;
				height: 500px;
				border: solid 1px;
			}

		@import "{{baseUrl}}dojox/layout/resources/FloatingPane.css";
		@import "{{baseUrl}}dojox/layout/resources/ResizeHandle.css";


		</style>
		<script type="text/javascript" djConfig="parseOnLoad:true,isDebug:true,gfxRenderer:'svg,canvas,vml,silverlight'" src="../../../../dojo/dojo.js"></script>
		<script type="text/javascript">
				var isTouchDevice = dojo.isIos || (navigator.userAgent.toLowerCase().indexOf("android") > -1)
				|| (navigator.userAgent.toLowerCase().indexOf("blackberry") > -1);
		</script>
		<script type="text/javascript">
			dojo.require("dojox.geo.charting.Map");
			dojo.require("dojox.charting.Chart");
			dojo.require("dojox.charting.axis2d.Default");
      		dojo.require("dojox.charting.plot2d.ClusteredBars");
			dojo.require("dojox.charting.plot2d.Grid");
			dojo.require("dojo.data.ItemFileReadStore");
			dojo.requireIf(isTouchDevice,"dojox.geo.charting.TouchInteractionSupport");
			dojo.requireIf(!isTouchDevice,"dojox.geo.charting.MouseInteractionSupport");
			dojo.require("dojox.geo.charting.KeyboardInteractionSupport");
			dojo.require("dojox.charting.themes.PlotKit.blue");

			dojo.require("dijit.form.RadioButton");

////////////////////////////////////////////////////////////////////////
			dojo.require("dojox.layout.FloatingPane");

function radiovalue(radios) {
    for (i = 0; radio = radios[i]; i++) {
        if (radio.checked) {
            return radio.value;
        }
    }
}


var edad = false;

			
// Declaramos el panel flotante		
var pFloatingPane;

dojo.ready(function(){
  pFloatingPane = new dojox.layout.FloatingPane({
     //title: "",
     resizable: false, dockable: false, resizeable: false,
     style: "position:relative;top:120;right:500;width:200px;height:320px;visibility:hidden;background:#fff",
     id: "pFloatingPane"
  }, dojo.byId("pFloatingPane"));


});
			
			var store = new dojo.data.ItemFileReadStore({
				url: "datastore/fichero1996.json"
			});

			dojo.addOnLoad(function(){




				changeProduct = function(radioButton) {
									//console.log("change product called " + productName);
									if (radioButton.checked) {
										map.setDataBindingAttribute(radioButton.value);
									}
								};

							//document.write(texto);
				//document.write(texto2);

				// Creamos el mapa referenciando los datos del JSON
				var map = new dojox.geo.charting.Map("map", "../resources/data/Spain2.json");


				// install mouse/touch navigation
				if (!isTouchDevice) {
					var mouseInteraction = new dojox.geo.charting.MouseInteractionSupport(map,{enablePan:true,enableZoom:true});
					mouseInteraction.connect();
				
				} else {
					var touchInteraction = new dojox.geo.charting.TouchInteractionSupport(map,{});
					touchInteraction.connect();
				}

				var keyboardInteraction = new dojox.geo.charting.KeyboardInteractionSupport(map, {enableZoom: true});
				keyboardInteraction.connect();

				/*
					var grupo = document.getElementById("formulario").radio;
					var radiovalor = radiovalue(grupo);
				*/
				/*if(radiovalor === "15-19"){
					map.setDataStore(store, "sexo_edadgr_2estudiosgr_1");
				}
				if(radiovalor === "25-29"){
					map.setDataStore(store, "sexo_edadgr_2estudiosgr_1");
				}
				if(radiovalor === "55-59"){
					map.setDataStore(store, "sexo_edadgr_2estudiosgr_1");
				}
				//map.setDataStore(store, "Edades_0-4");
		
				//add series to map 
				map.addSeries([{
					name: "Entre 0 y 100000",
					min: "0.0",
					max: "100000.0",
					color: "#FFCE52"
				}, {
					name: "Entre 100000 y 1000000",
					min: "100000.0",
					max: "1000000.0",
					color: "#63A584"
				}, {
					name: "Entre 1000000 y 5000000",
					min: "1000000.0",
					max: "5000000.0",
					color: "#CE6342"
				}]);*/
				//declare associated legend
				/*var legend = new dojox.geo.charting.widget.Legend({
					map: map
				});*/


				map.onFeatureOver = function(feature){
					
					var indice = document.formul.miSelect.selectedIndex;
					    
					    var valor = document.formul.miSelect.options[indice].value;


					
						if(valor==="1991"){

						 	store.fetchItemByIdentity({
				                        identity: feature.id,
				                        onItem: function(item){
								//document.write("hola");
								// Anyadimos el titulo al panel
								pFloatingPane.setTitle("<b>"+feature.id+"</b>");
								// Anyadimos los datos al contenido del panel								
								pFloatingPane.setContent("Edades_0-4: "+store.getValue(item, "Edades_0-4")+"<br>"
									+"Edades_5-9: "+store.getValue(item, "Edades_5-9")+"<br>"
									+"Edades_10-14: "+store.getValue(item, "sexo_edadgr_1estudiosgr_1")+"<br>"
									+"Edades_15-19: "+store.getValue(item, "Edades_15-19")+"<br>"
									+"Edades_20-24: "+store.getValue(item, "Edades_20-24")+"<br>"
									+"Edades_25-29: "+store.getValue(item, "Edades_25-29")+"<br>"
									+"Edades_30-34: "+store.getValue(item, "Edades_30-34")+"<br>"
									+"Edades_35-39: "+store.getValue(item, "Edades_35-39")+"<br>"
									+"Edades_40-44: "+store.getValue(item, "Edades_40-44")+"<br>"
									+"Edades_45-49: "+store.getValue(item, "Edades_45-49")+"<br>"
									+"Edades_50-54: "+store.getValue(item, "Edades_50-54")+"<br>"
									+"Edades_55-59: "+store.getValue(item, "Edades_55-59")+"<br>"
									+"Edades_60-64: "+store.getValue(item, "Edades_60-64")+"<br>"
									+"Edades_65-69: "+store.getValue(item, "Edades_65-69")+"<br>"
									+"Edades_70-74: "+store.getValue(item, "Edades_70-74")+"<br>"
									+"Edades_75-79: "+store.getValue(item, "Edades_75-79")+"<br>"
									+"Edades_80-84: "+store.getValue(item, "Edades_80-84")+"<br>"
									+"Edades_85-89: "+store.getValue(item, "Edades_85-89")+"<br>"
									+"Edades_90+: "+store.getValue(item, "Edades_90+")+"<br>");										
								pFloatingPane.startup();
								
			                                        

							}
						});
					pFloatingPane.show();	
							  
					}
					else{

						 	store.fetchItemByIdentity({
				                        identity: feature.id,
				                        onItem: function(item){

								// Anyadimos el titulo al panel
								pFloatingPane.setTitle("<b>"+feature.id+"</b>");
								// Anyadimos los datos al contenido del panel								
								pFloatingPane.setContent("Edades_0-4: "+store.getValue(item, "Edades_0-4")+"<br>"
									+"Edades_5-9_: "+store.getValue(item, "Edades_5-9")+"<br>"
									+"Edades_10-14: "+store.getValue(item, "Edades_10-14")+"<br>"
									+"Edades_15-19: "+store.getValue(item, "Edades_15-19")+"<br>"
									+"Edades_20-24: "+store.getValue(item, "Edades_20-24")+"<br>"
									+"Edades_25-29: "+store.getValue(item, "Edades_25-29")+"<br>"
									+"Edades_30-34: "+store.getValue(item, "Edades_30-34")+"<br>"
									+"Edades_35-39: "+store.getValue(item, "Edades_35-39")+"<br>"
									+"Edades_40-44: "+store.getValue(item, "Edades_40-44")+"<br>"
									+"Edades_45-49: "+store.getValue(item, "Edades_45-49")+"<br>"
									+"Edades_50-54: "+store.getValue(item, "Edades_50-54")+"<br>"
									+"Edades_55-59: "+store.getValue(item, "Edades_55-59")+"<br>"
									+"Edades_60-64: "+store.getValue(item, "Edades_60-64")+"<br>"
									+"Edades_65-69: "+store.getValue(item, "Edades_65-69")+"<br>"
									+"Edades_70-74: "+store.getValue(item, "Edades_70-74")+"<br>"
									+"Edades_75-79: "+store.getValue(item, "Edades_75-79")+"<br>"
									+"Edades_80-84: "+store.getValue(item, "Edades_80-84")+"<br>"
									+"Edades_85-89: "+store.getValue(item, "Edades_85-89")+"<br>"
									+"Edades_90+: "+store.getValue(item, "Edades_90+")+"<br>");										
								pFloatingPane.startup();
								
			                                        

							}
						});
					pFloatingPane.show();	
							  
					}
							//alert(chartStore.getValue("VT","product B"));
							//alert("aa"+dojo.global["datos"]);
												//alert(dojo.global["informacion"]);

						
						//pFloatingPanes[0].title = "Nuevo titulo";
						
					texto = dojo.global["datos"];


					
					
					// Si no tenemos el cursor encima de alguna provincia, no mostramos ningun panel
					
					
						
						
					
/////////////////////////////		
							
					if (!feature) {
						
						
						/*productSeries = [0,0,0,0,0,0];
						chart.updateSeries("productSeries",productSeries);
						chart.render();
						*/

					} else if (!feature.isSelected) {
						

						
					}
				};
			});
		</script>
	</head>
	<body class="tundra">
		<h1>Mapa provincial de España</h1>
		<p>Situa el cursor sobre la provincia para obtener sus datos</p>
		<div style="width:610px;height:400px;border:solid 1px;background:#f5f5f5;" id="map">
			<div id="pFloatingPane"></div>		

		 </div>
				<div>
					<form name="formul">
					Elige la opción a visualizar:
					<select name="miSelect">
						<option value="1991" selected>Edades 1991
						<option value="2001" >Edades 2001
					</select>
					<br>
					
					<br>
					<br>
					</form>


						

						<table id="productChoice" cellspacing="10" style="border: 1px">
		        <tr>
		        <td><label>Edades :</label></td>
				<td><input type="radio" dojoType="dijit.form.RadioButton" name="product" id="radioA" checked
			    onchange="changeProduct(this)"
			    	value="Edades_15-19" />
			    <label for="Edades_15-19">15-19</label>
			    </td>
			    <td><input type="radio" dojoType="dijit.form.RadioButton" name="product" id="radioB"
			    onchange="changeProduct(this)"
			    	value="Edades_15-19" />
			    <label for="Edades_25-29">25-29</label>
			    </td>
			    <td><input type="radio" dojoType="dijit.form.RadioButton" name="product" id="radioC"
			    onchange="changeProduct(this)"
			    	value="Edades_55-59" />
			    <label for="Edades_55-59">55-59</label>
			    </td>
				</tr>
			</table> 
				</div>
			
					

			
			

		

		</div>
	</body>
</html>
