	<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Chart: Map&Chart</title>
		<style type="text/css">
			@import "../../../../dojo/resources/dojo.css";
			@import "../../../../dijit/tests/css/dijitTests.css";
			@import "../../../../dijit/themes/tundra/tundra.css";
			@import "../resources/Map.css";
			.mapContainer {
				display: none;
				width: 810px;
				height: 400px;
				border: solid 1px;
			}
}
.mapVerticalContainer {
display: none;
width: 405px;
height: 500px;
border: solid 1px;
}
@import "{{baseUrl}}dojox/layout/resources/FloatingPane.css";
@import "{{baseUrl}}dojox/layout/resources/ResizeHandle.css";
</style>
<script type="text/javascript" djConfig="parseOnLoad:true,isDebug:true,gfxRenderer:'svg,canvas,vml,silverlight'" src="../../../../dojo/dojo.js"></script>
<script type="text/javascript">
var isTouchDevice = dojo.isIos || (navigator.userAgent.toLowerCase().indexOf("android") > -1)
|| (navigator.userAgent.toLowerCase().indexOf("blackberry") > -1);
</script>
<script type="text/javascript">
dojo.require("dojox.geo.charting.Map");
dojo.require("dojox.geo.charting.widget.Legend");
dojo.require("dijit.layout.BorderContainer");
			dojo.require("dojox.charting.Chart");
			dojo.require("dojox.charting.axis2d.Default");
      			dojo.require("dojox.charting.plot2d.ClusteredBars");
			dojo.require("dojox.charting.plot2d.Grid");
			dojo.require("dojo.data.ItemFileReadStore");
			dojo.requireIf(isTouchDevice,"dojox.geo.charting.TouchInteractionSupport");
			dojo.requireIf(!isTouchDevice,"dojox.geo.charting.MouseInteractionSupport");
			dojo.require("dojox.geo.charting.KeyboardInteractionSupport");
			dojo.require("dojox.charting.themes.PlotKit.blue");
			dojo.require("dijit.form.RadioButton");
			dojo.require("dojox.layout.FloatingPane");
			dojo.require("dijit.form.Select");
							dojo.require("dojo.parser");
							dojo.require("dojox.charting.DataChart");
							dojo.require("dojo.data.ItemFileWriteStore");
							dojo.require("dijit.form.NumberSpinner");
			var store = new dojo.data.ItemFileReadStore({
				url: "datastore/fichero1996.json"
			});
var store2 = new dojo.data.ItemFileReadStore({
			url: "datastore/intervalos.json"
			});
			var variable = "sexo-99-estud_gr-99-edad_gr-99-";			dojo.addOnLoad(function(){


var cols = new dojox.charting.DataChart("cols", {
				displayRange:60,
				scroll:false,
				xaxis:{labelFunc:"seriesLabels"},
				yaxis:{max:100},
				type: dojox.charting.plot2d.Columns
			});
			cols.setStore(store, {Provincia:"*"},"sexo-99-estud_gr-99-edad_gr-99-");
			

changeProduct2 = function(Select){

	var splt = variable.split("-");
	var cadena = "";
	for(i = 0; i < splt.length -1; i = i + 2){
		var auxiliar = splt[i]+splt[i + 1];
		
		var selectSplit = Select.value.split("-");
		if(splt[i] === selectSplit[0]){
			auxiliar = splt[i] +"-"+ selectSplit[1]+"-";
				
		}
		else{
			auxiliar = splt[i]+"-"+splt[i + 1]+"-";
		}
		cadena = cadena + auxiliar;
	}
	variable = cadena;

var valor = document.getElementsByName("select2")[0].value;
var consultaIntervalos = valor+"-"+cadena;

	auxStore = this.store2;
	

auxStore.fetchItemByIdentity({
				                        identity: consultaIntervalos,
				                        onItem: function(item){
				                        
map.addSeries([{
                                        name: auxStore.getValue(item, "min_t")+"-"+auxStore.getValue(item, "p20_t"),
                                        min: auxStore.getValue(item, "min_t")-1,
                                        max: auxStore.getValue(item, "p20_t"),
                                        color: "#01DFD7"
                                }, {
                                        name: auxStore.getValue(item, "p20_t")+"-"+auxStore.getValue(item, "p40_t"),
                                        min: auxStore.getValue(item, "p20_t"),
                                        max: auxStore.getValue(item, "p40_t"),
                                        color: "#0080FF"
                                }, {
                                        name: auxStore.getValue(item, "p40_t")+"-"+auxStore.getValue(item, "p60_t"),
                                        min: auxStore.getValue(item, "p40_t"),
                                        max: auxStore.getValue(item, "p60_t"),
                                        color: "#FFFF00"
                                }, {
                                        name: auxStore.getValue(item, "p60_t")+"-"+auxStore.getValue(item, "p80_t"),
                                        min: auxStore.getValue(item, "p60_t"),
                                        max: auxStore.getValue(item, "p80_t"),
                                        color: "#DF7401"
                                }, {
                                        name: auxStore.getValue(item, "p80_t")+"-"+auxStore.getValue(item, "max_t"),
                                        min: auxStore.getValue(item, "p80_t"),
                                        max: auxStore.getValue(item, "max_t")+1,
                                        color: "#DF0101"
                                }]);				
					
							}
							
						});
// PONER AQUI

	map.setDataBindingAttribute(variable);
	cols.setStore(store, {Provincia:"*"},variable);
	
	this.legend.destroy();
 
	this.legend = new dojox.geo.charting.widget.Legend({
					map: map
				});

};
changeProduct3 = function(Select){

	this.store = new dojo.data.ItemFileReadStore({
				url: "datastore/fichero"+Select.value+".json"
				
			});
	
	//map.setDataStore(this.store, variable);
	var splt = variable.split("-");
var cadena = "";
for(i = 0; i < splt.length -1; i = i + 2){
	var auxiliar = splt[i]+splt[i + 1];
	var selectSplit = Select.value.split("-");
	if(splt[i] === selectSplit[0]){
		auxiliar = splt[i] +"-"+ selectSplit[1]+"-";
			
	}
	else{
		auxiliar = splt[i]+"-"+splt[i + 1]+"-";
	}
	cadena = cadena + auxiliar;
}
variable = cadena;

//variable = variable+splt[splt.length-1];

//variable = cadena;
var consultaIntervalos = Select.value+"-"+cadena;


	auxStore = this.store2;
	

auxStore.fetchItemByIdentity({
				                        identity: consultaIntervalos,
				                        onItem: function(item){
map.addSeries([{
                                        name: auxStore.getValue(item, "min_t")+"-"+auxStore.getValue(item, "p20_t"),
                                        min: auxStore.getValue(item, "min_t")-1,
                                        max: auxStore.getValue(item, "p20_t"),
                                        color: "#01DFD7"
                                }, {
                                        name: auxStore.getValue(item, "p20_t")+"-"+auxStore.getValue(item, "p40_t"),
                                        min: auxStore.getValue(item, "p20_t"),
                                        max: auxStore.getValue(item, "p40_t"),
                                        color: "#0080FF"
                                }, {
                                        name: auxStore.getValue(item, "p40_t")+"-"+auxStore.getValue(item, "p60_t"),
                                        min: auxStore.getValue(item, "p40_t"),
                                        max: auxStore.getValue(item, "p60_t"),
                                        color: "#FFFF00"
                                }, {
                                        name: auxStore.getValue(item, "p60_t")+"-"+auxStore.getValue(item, "p80_t"),
                                        min: auxStore.getValue(item, "p60_t"),
                                        max: auxStore.getValue(item, "p80_t"),
                                        color: "#DF7401"
                                }, {
                                        name: auxStore.getValue(item, "p80_t")+"-"+auxStore.getValue(item, "max_t"),
                                        min: auxStore.getValue(item, "p80_t"),
                                        max: auxStore.getValue(item, "max_t")+1,
                                        color: "#DF0101"
                                }]);				
					
							}
						});
// PONER AQUI
map.setDataStore(this.store, variable);
	map.setDataBindingAttribute(variable);
	cols.setStore(store, {Provincia:"*"},variable);
	this.legend.destroy();
 
	this.legend = new dojox.geo.charting.widget.Legend({
					map: map
				});

};				var map = new dojox.geo.charting.Map("map", "../resources/data/Spain.json");
if (!isTouchDevice) {
					var mouseInteraction = new dojox.geo.charting.MouseInteractionSupport(map,{enablePan:true,enableZoom:true});
					mouseInteraction.connect();
				} else {
					var touchInteraction = new dojox.geo.charting.TouchInteractionSupport(map,{});
					touchInteraction.connect();
				}
				var keyboardInteraction = new dojox.geo.charting.KeyboardInteractionSupport(map, {enableZoom: true});
				keyboardInteraction.connect();
map.setDataStore(store, "sexo-99-estud_gr-99-edad_gr-99-");			map.addSeries([{
					name: "30-35",
					min: "30"-1,
					max: "35",
					color: "#01DFD7"
				}, {
					name: "35-38",
					min: "35",
					max: "38",
					color: "#0080FF"
				}, {
					name: "38-41",
					min: "38",
					max: "41",
					color: "#FFFF00"
				}, {
					name: "41-42 ",
					min: "41",
					max: "42",
					color: "#DF7401"
				}, {
					name: "42-51",
					min: "42",
					max: "51"+1,
					color: "#DF0101"
				}]);
				
				this.legend = new dojox.geo.charting.widget.Legend({
					map: map
				});
				map.onFeatureOver = function(feature){
					    var valor = document.getElementsByName("select2")[0].value;										
										store.fetchItemByIdentity({
				                        identity: feature.id,
				                        onItem: function(item){
				                        	if(store.getValue(item, variable) == undefined){
				                        		feature.markerText = feature.id + ": " + "conjunto vacio";
				                        	}
				                        	else if(store.getValue(item, variable) == "0.000001"){
				                        		feature.markerText = feature.id + ": " + "0";
				                        	}
				                        	else{
				                        		feature.markerText = feature.id + ": " + store.getValue(item,variable);
				                        	}
			                        	}
				                        });
											
				};
			});
		</script>
	</head>
	<body class="tundra">

				<h1>Datos sobre EPA_tasas_ocup</h1>
						<p>Situa el cursor sobre la provincia para obtener sus datos</p>
						<table>
						<tr>
						<td>
						<div style="width:610px;height:400px;border:solid 1px;background:#f5f5f5;" id="map">;
						</div>
						</td>
						<td>
						<div   >

<select name="select1" data-dojo-type="dijit.form.Select" onchange="changeProduct2(this)"><option value="sexo-1" >hombre</option><option value="sexo-6" >mujer</option><option value="sexo-99" selected="selected">ambos</option></select><br><br>
<select name="select1" data-dojo-type="dijit.form.Select" onchange="changeProduct2(this)"><option value="estud_gr-1" >Sin estudios</option><option value="estud_gr-2" >Estudios primarios</option><option value="estud_gr-3" >Estudios superiores</option><option value="estud_gr-99" selected="selected">Todos</option></select><br><br>
<select name="select1" data-dojo-type="dijit.form.Select" onchange="changeProduct2(this)"><option value="edad_gr-1" >16-19</option><option value="edad_gr-2" >20-24</option><option value="edad_gr-3" >25-29</option><option value="edad_gr-4" >30-34</option><option value="edad_gr-5" >35-44</option><option value="edad_gr-6" >45-54</option><option value="edad_gr-7" >55-64</option><option value="edad_gr-8" >Mas de 65</option><option value="edad_gr-99" selected="selected">todos</option></select><br><br>
<select name="select2" size="5" data-dojo-type="dijit.form.Select" onchange="changeProduct3(this)">
<option value="1996" >1996</option>
	<option value="1997" >1997</option>
	<option value="1998" >1998</option>
	<option value="1999" >1999</option>
	<option value="2000" >2000</option>
	<option value="2001" >2001</option>
	<option value="2002" >2002</option>
	<option value="2003" >2003</option>
	<option value="2004" >2004</option>
	<option value="2005" >2005</option>
	<option value="2006" >2006</option>
	<option value="2007" >2007</option>
	<option value="2008" >2008</option>
	<option value="2009" >2009</option>
	<option value="2010" >2010</option>
	<option value="2011" >2011</option>
	</select>

				</div>
		</div>
			
			</td>
			</tr>
			</table>
			<div id="cols"></div></tr>
			
				</body>
</html>
